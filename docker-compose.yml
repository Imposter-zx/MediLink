services:
  # Frontend React Application
  frontend:
    build: .
    ports:
      - "5173:80"
    environment:
      - VITE_API_URL=http://localhost:3000/api
      - VITE_MEDPLUM_BASE_URL=https://api.medplum.com/
    restart: always

  # Backend NestJS API
  backend:
    build:
      context: ./backend/medilink-api
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - PORT=3000
      - NODE_ENV=production
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - MEDPLUM_BASE_URL=https://api.medplum.com/
      - MEDPLUM_CLIENT_ID=${MEDPLUM_CLIENT_ID}
      - MEDPLUM_CLIENT_SECRET=${MEDPLUM_CLIENT_SECRET}
      - ENCRYPTION_KEY=${ENCRYPTION_KEY}
    depends_on:
      - redis
    restart: always

  # Redis for session management and caching
  redis:
    image: redis:alpine
    ports:
      - "6379:6379"
    restart: always
